<%= form_tag "/sensors/#{@sensor.sid}", :method => :put, :class => 'basic-form validate' do %>

  <%= error_messages_for(@sensor) %>

  <div id="sensor_config">
    <div class="title">General</div>
    <div class="config_content">
      <div class="grid_6">
        <p>
          <%= label_tag 'Name' %>
          <br />
          <%= text_field_tag '[sensor][name]', @sensor.name, :placeholder => 'Domain Name', :class => 'required', :disabled => 'disabled' if @sensor.is_virtual_sensor? %>
          <%= text_field_tag '[sensor][name]', @sensor.name, :placeholder => 'Domain Name', :class => 'required' unless @sensor.is_virtual_sensor? %>
        </p>
        <p>
          <%= label_tag 'Mode' %>
          <br />
          <%= select_tag '[role][redBorder][snort][mode]', select_role_options(@sensor, ["redBorder", "snort", "mode"], Sensor::MODES, :selected => @role.override_attributes["redBorder"]["snort"]["mode"]) %>
        </p>
      </div>
      <div class="grid_5">
        <% if @sensor.is_virtual_sensor? %>
          <p>
            <%= label_tag 'IP' %>
            <br />
            <%= text_field_tag '[sensor][ipir]', @sensor.ipdir, :placeholder => 'Domain Ip', :class => 'required', :disabled => 'disabled' %>
          </p>
        <% end %>
      </div>
    </div>
    <div class="title second">Logging</div>
    <div class="config_content logging">
      <div class="grid_6">
        <p>
          <%= label_tag 'Syslog Servers' %>
          <br/>
          <%= text_field_tag "[role][redBorder][barnyard2][syslog_servers]", (@role.override_attributes["redBorder"]["barnyard2"]["syslog_servers"].map{|s| s.to_s}.join(", ") unless @role.override_attributes["redBorder"]["barnyard2"]["syslog_servers"].nil?), :placeholder => @sensor.role_value(["redBorder", "barnyard2", "syslog_servers"]).map{|s| s.to_s}.join(", "), :class => 'listipaddr', :data => @sensor.role_value(["redBorder", "barnyard2", "syslog_servers"]).map{|s| s.to_s}.join(", ") %>
        </p>
      </div>
      <div class="grid_5">
        <p>
          <% if @sensor.role_value(["redBorder", "snort", "save_pcap"]) %>
                  <%=  image_tag "icons/incident.png" %>
                <% else %>
                  <%=  image_tag "icons/fp.png" %>
                <% end %>
          <%= label_tag 'Save pcap files' %>
          <i>(Info about pcap files and where it will be saved.)</i>
          <br/>
          <%= select_tag "[role][redBorder][snort][save_pcap]", select_role_options(@sensor, ["redBorder","snort","save_pcap"], Sensor::PREPROCESSOR_VALUES, :selected => @role.override_attributes["redBorder"]["snort"]["save_pcap"]) %>
        </p>
      </div>
    </div>
    <div class="title second">Preprocessors</div>
    <div class="config_content preprocessor">
      <% cont = 1 %>
      <% size = Sensor.chef_sensor_role.override_attributes["redBorder"]["snort"]["preprocessors"].size %>
      <table>
        <tbody>
          <tr>
            <% Sensor.chef_sensor_role.override_attributes["redBorder"]["snort"]["preprocessors"].each do |key, value| %>
              <td class="size_33">
                <% if @sensor.role_value(["redBorder", "snort", "preprocessors", key, "mode"]) %>
                  <%=  image_tag "icons/incident.png" %>
                <% else %>
                  <%=  image_tag "icons/fp.png" %>
                <% end %>
                <%= label_tag key.capitalize %>
                <i>(<%= value["description"] %>)</i>
                <br/>
                <%= select_tag "[role][redBorder][snort][preprocessors][#{key}][mode]", select_role_options(@sensor, ["redBorder","snort","preprocessors","#{key}", "mode"], Sensor::PREPROCESSOR_VALUES, :selected => selected_preprocessor_value(@role, key)) %>
              </td>
              <%= "</tr><tr>".html_safe if (cont%3 == 0 and cont < size) %>
              <% cont = cont + 1 %>
            <% end %>
            <% ((3 -(cont - 1)%3)%3).times do %>
              <td class="size_33 noselect"></td>
            <% end %>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="title second">IP Variables <i>(Blank boxs will be inherited from parent.)</i></div>
    <div class="config_content preprocessor">
      <% cont = 1 %>
      <% size = RuleVariable.all(:type => RuleVariable::IPVAR).size %>
      <table>
        <tbody>
          <tr>
            <% RuleVariable.all(:type => RuleVariable::IPVAR).each do |v| %>
              <td class="size_33">
                <%= label_tag v.name %>
                <br/>
                <%= text_field_tag "[role][redBorder][snort][ipvars][#{v.name}]", selected_variable_value(@role, "ipvars", v.name), :placeholder => @sensor.role_value(["redBorder", "snort", "ipvars", v.name]), :data => @sensor.role_value(["redBorder", "snort", "ipvars", v.name]), :class => 'snort_ipvar' %>
              </td>
              <%= "</tr><tr>".html_safe if (cont%3 == 0 and cont < size) %>
              <% cont = cont + 1 %>
            <% end %>
            <% ((3 -(cont - 1)%3)%3).times do %>
              <td class="size_33 noselect"></td>
            <% end %>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="title second">Port Variables<i>(Blank boxs will be inherited from parent.)</i></div>
    <div class="config_content preprocessor">
      <% cont = 1 %>
      <% size = RuleVariable.all(:type => RuleVariable::PORTVAR).size %>
      <table>
        <tbody>
          <tr>
            <% RuleVariable.all(:type => RuleVariable::PORTVAR).each do |v| %>
              <td class="size_33">
                <%= label_tag v.name %>
                <br/>
                <%= text_field_tag "[role][redBorder][snort][portvars][#{v.name}]", selected_variable_value(@role, "portvars", v.name), :placeholder => @sensor.role_value(["redBorder", "snort", "portvars", v.name]), :data => @sensor.role_value(["redBorder", "snort", "portvars", v.name]), :class => 'snort_portvar' %>
              </td>
              <%= "</tr><tr>".html_safe if (cont%3 == 0 and cont < size) %>
              <% cont = cont + 1 %>
            <% end %>
            <% ((3 -(cont - 1)%3)%3).times do %>
              <td class="size_33 noselect"></td>
            <% end %>
          </tr>
        </tbody>
      </table>
    </div>

    <%= form_actions do %>
      <%= button "Save", :class => 'success' %>
      <%= button "Cancel", :class => 'warning cancel' %>
    <% end %>
  </div>

<% end %>
